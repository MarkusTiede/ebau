image: docker:latest

before_script:
    - apk update
    - apk add py-pip
    - pip install docker-compose
    - docker-compose up -d -f docker/gitlab-ci-compose.yml

after_script:
    - docker-compose stop -f docker/gitlab-ci-compose.yml
 

services:
    - docker:dind
    #  - adsy/camac_php_oracle:v1
    #  - memcached
    #  - wnameless/oracle-xe-11g

stages:
    - test

run-test:
    stage: test
    script:
        - python .wait-for-oracle-db.py camac_db 49161
        - make _init
        - make db-init
        - make config-import-ci
        - make run-acceptance-tests-ci
        - docker-compose stop

variables:
  LANG: C.UTF-8
  LC_ALL: C.UTF-8
