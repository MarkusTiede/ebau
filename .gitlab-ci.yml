image: docker:vcamac-dind

before_script:
    - apk update
    - apk add make
    - apk add py-pip
    - apk add bash
    - apk add git
    - apk add openssh
    - pip install docker-compose
    - docker-compose -f docker/gitlab-ci-compose.yml up -d

after_script:
    - docker-compose -f docker/gitlab-ci-compose.yml stop
 
stages:
    - test

run-test:
    stage: test
    script:
        - make _init-ci
        - make db-init
        - make config-import-ci
        - make run-acceptance-tests-ci
        - docker-compose stop

variables:
  LANG: C.UTF-8
  LC_ALL: C.UTF-8
