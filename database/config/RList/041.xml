<row>
  <table_name>r_list</table_name>
  <model_name>configuration.RList</model_name>
  <data>
    <resource_id type="int">41</resource_id>
    <query type="str">SELECT
  "INSTANCE"."INSTANCE_ID",
  "ANSWER_DOK_NR"."ANSWER"   AS "DOSSIER_NR",
  "FORM"."NAME"              AS "FORM",
  TO_CHAR("ACTIVATION"."DEADLINE_DATE", 'DD.MM.YYYY') AS "DEADLINE",
  "LOCATION"."NAME"          AS "COMMUNITY",
  "APPLICANT_VIEW"."APPLICANT",
  (SELECT LISTAGG("NAME", ', ') WITHIN GROUP (ORDER BY "NAME")
    FROM INTENTIONS WHERE "INSTANCE_ID" = "INSTANCE"."INSTANCE_ID") AS "INTENT",
  CASE
    WHEN "ANSWER_STREET_BG"."ANSWER" IS NOT NULL THEN "ANSWER_STREET_BG"."ANSWER"
    WHEN "ANSWER_STREET_NP"."ANSWER" IS NOT NULL THEN "ANSWER_STREET_NP"."ANSWER"
    WHEN "ANSWER_STREET_247"."ANSWER" IS NOT NULL THEN "ANSWER_STREET_247"."ANSWER"
  END AS "STREET",
  "ACTIVATION"."REASON"      AS "REASON",
  "CIRCULATION_STATE"."NAME" AS "CIRC_STATE"
FROM
  "INSTANCE"
LEFT JOIN "APPLICANT_VIEW" ON (
  "INSTANCE"."INSTANCE_ID" = "APPLICANT_VIEW"."INSTANCE_ID"
)
JOIN
  "INSTANCE_LOCATION" ON (
    "INSTANCE"."INSTANCE_ID" = "INSTANCE_LOCATION"."INSTANCE_ID"
  )

JOIN
  "LOCATION" ON (
   "INSTANCE_LOCATION"."LOCATION_ID" = "LOCATION"."LOCATION_ID"
  )

JOIN
  FORM ON (
    "INSTANCE"."FORM_ID" = "FORM"."FORM_ID"
)

JOIN "ANSWER" "ANSWER_DOK_NR" ON (
    "INSTANCE"."INSTANCE_ID" = "ANSWER_DOK_NR"."INSTANCE_ID"
)

LEFT JOIN "ANSWER_STREET_BG" ON (
    "INSTANCE"."INSTANCE_ID" = "ANSWER_STREET_BG"."INSTANCE_ID"
  )

LEFT JOIN "ANSWER_STREET_NP" ON (
    "INSTANCE"."INSTANCE_ID" = "ANSWER_STREET_NP"."INSTANCE_ID"
  )
LEFT JOIN "ANSWER_STREET_247" ON (
    "INSTANCE"."INSTANCE_ID" = "ANSWER_STREET_247"."INSTANCE_ID"
  )

JOIN
  "CIRCULATION" ON (
    "CIRCULATION"."INSTANCE_ID" = "INSTANCE"."INSTANCE_ID"
  )

JOIN
  "ACTIVATION" ON (
    "ACTIVATION"."CIRCULATION_ID" = "CIRCULATION"."CIRCULATION_ID"
    AND
    "ACTIVATION"."SERVICE_ID" = [SERVICE_ID]
  )

LEFT JOIN
  "CIRCULATION_STATE" ON (
    "ACTIVATION"."CIRCULATION_STATE_ID" = "CIRCULATION_STATE"."CIRCULATION_STATE_ID"
  )

WHERE
  (
    "ACTIVATION"."CIRCULATION_STATE_ID" = 1
    OR
    "ACTIVATION"."CIRCULATION_STATE_ID" = 41
  )
    AND
    "INSTANCE"."INSTANCE_STATE_ID" = GET_INST_STATE_ID_BY_NAME('circ')
ORDER BY DOSSIER_NR ASC</query>
  </data>
</row>

